---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import Comments from '../../components/Comments.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<BaseLayout title={`${post.data.title} - Josephine's Blog`}>
  <article class="max-w-2xl mx-auto">
    <!-- Header -->
    <header class="mb-12">
      <div class="flex items-center gap-3 mb-6">
        <time class="text-sm text-white/40 font-mono">
          {post.data.pubDate.toLocaleDateString('zh-CN')}
        </time>
        {post.data.tags && (
          <div class="flex gap-2">
            {post.data.tags.map((tag: string) => (
              <span class="text-sm text-white/30">#{tag}</span>
            ))}
          </div>
        )}
      </div>
      
      <h1 class="text-3xl md:text-4xl font-semibold leading-tight mb-6">
        {post.data.title}
      </h1>
      
      <p class="text-lg text-white/50 leading-relaxed">
        {post.data.description}
      </p>
    </header>

    <!-- Content -->
    <div class="prose prose-invert prose-lg max-w-none
      prose-headings:font-semibold prose-headings:text-white
      prose-p:text-white/70 prose-p:leading-relaxed
      prose-a:text-white prose-a:underline prose-a:underline-offset-4
      prose-strong:text-white prose-strong:font-medium
      prose-code:text-white/80 prose-code:bg-white/5 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded
      prose-pre:bg-white/5 prose-pre:border prose-pre:border-white/10 prose-pre:rounded-xl
      prose-blockquote:border-white/20 prose-blockquote:text-white/60
      prose-li:text-white/70
      prose-hr:border-white/10
    ">
      <Content />
    </div>

    <!-- Share -->
    <div class="mt-16 pt-8 border-t border-white/5">
      <div class="flex items-center justify-between">
        <a href="/blog" class="text-sm text-white/40 hover:text-white transition-colors">
          ← 返回博客
        </a>
        <button 
          id="copy-link"
          class="text-sm text-white/40 hover:text-white transition-colors"
        >
          复制链接
        </button>
      </div>
    </div>

    <!-- Comments -->
    <div class="mt-16">
      <h3 class="text-xl font-medium mb-8">评论</h3>
      <Comments />
    </div>
  </article>
  
  <script is:inline>
    document.getElementById('copy-link')?.addEventListener('click', async () => {
      await navigator.clipboard.writeText(window.location.href);
      alert('链接已复制');
    });
  </script>
</BaseLayout>
