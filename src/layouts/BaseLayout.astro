---
import '@unocss/reset/tailwind.css';
import 'uno.css';

interface Props {
  title: string;
  description?: string;
}

const { title, description = '探索技术、分享思考的个人博客' } = Astro.props;
---

<!doctype html>
<html lang="zh-CN" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta name="generator" content={Astro.generator} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{title}</title>
    <style is:global>
      html {
        background-color: #000;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: rgba(255,255,255,0.15);
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: rgba(255,255,255,0.25);
      }
      
      ::selection {
        background: rgba(255,255,255,0.2);
      }
    </style>
  </head>
  <body class="min-h-screen bg-black text-white antialiased">
    <div class="flex flex-col min-h-screen">
      <!-- 导航栏 - Apple 风格 -->
      <header class="fixed top-0 left-0 right-0 z-50 bg-black/80 backdrop-blur-xl border-b border-white/5">
        <nav class="max-w-6xl mx-auto px-6 h-12 flex items-center justify-between">
          <a href="/" class="text-sm font-medium text-white/90 hover:text-white transition-colors">
            The Jo Journey
          </a>
          
          <div class="flex items-center gap-8">
            <a href="/blog" class="text-xs text-white/60 hover:text-white transition-colors">博客</a>
            <a href="/projects" class="text-xs text-white/60 hover:text-white transition-colors">项目</a>
            <a href="/about" class="text-xs text-white/60 hover:text-white transition-colors">关于</a>
            <a href="/contact" class="text-xs text-white/60 hover:text-white transition-colors">联系</a>
            
            <div class="flex items-center gap-4 ml-4">
              <button id="search-btn" class="text-white/40 hover:text-white transition-colors" aria-label="搜索">
                <span class="i-lucide-search text-sm"></span>
              </button>
              <a href="https://github.com/hollipembletoncrf40-sudo" target="_blank" class="text-white/40 hover:text-white transition-colors">
                <span class="i-lucide-github text-sm"></span>
              </a>
            </div>
          </div>
        </nav>
      </header>

      <!-- 主内容 -->
      <main class="flex-1 pt-24 pb-20">
        <div class="max-w-4xl mx-auto px-6">
          <slot />
        </div>
      </main>

      <!-- 页脚 - 极简 -->
      <footer class="border-t border-white/5 py-8">
        <div class="max-w-6xl mx-auto px-6 flex items-center justify-between text-xs text-white/30">
          <span>© {new Date().getFullYear()} Josephine. All rights reserved.</span>
          <div class="flex items-center gap-6">
            <a href="/rss" class="hover:text-white/60 transition-colors">RSS</a>
            <a href="https://github.com/hollipembletoncrf40-sudo" target="_blank" class="hover:text-white/60 transition-colors">GitHub</a>
          </div>
        </div>
      </footer>
    </div>

    <!-- 搜索 -->
    <div id="search-dialog" class="fixed inset-0 z-100 hidden">
      <div class="absolute inset-0 bg-black/90 backdrop-blur-xl" id="search-overlay"></div>
      <div class="absolute top-32 left-1/2 -translate-x-1/2 w-full max-w-2xl px-6">
        <div class="bg-white/5 border border-white/10 rounded-2xl p-6 backdrop-blur-xl">
          <div class="flex items-center gap-4">
            <span class="i-lucide-search text-white/40"></span>
            <input 
              type="text" 
              id="search-input"
              placeholder="搜索..." 
              class="flex-1 bg-transparent border-none outline-none text-white text-lg placeholder-white/30"
              autofocus
            />
            <kbd class="text-xs text-white/30 bg-white/5 px-2 py-1 rounded">ESC</kbd>
          </div>
          <div id="search-results" class="mt-6">
            <p class="text-center text-white/30 py-8">输入关键词开始搜索</p>
          </div>
        </div>
      </div>
    </div>

    <script is:inline>
      const searchBtn = document.getElementById('search-btn');
      const searchDialog = document.getElementById('search-dialog');
      const searchOverlay = document.getElementById('search-overlay');
      const searchInput = document.getElementById('search-input');
      const searchResults = document.getElementById('search-results');

      let pagefind = null;
      let pagefindLoaded = false;

      async function initPagefind() {
        if (pagefindLoaded) return;
        pagefindLoaded = true;
        try {
          pagefind = await import('/pagefind/pagefind.js');
          await pagefind.init();
        } catch (e) {
          pagefind = null;
        }
      }

      function openSearch() {
        searchDialog.classList.remove('hidden');
        searchInput.focus();
        initPagefind();
      }

      function closeSearch() {
        searchDialog.classList.add('hidden');
        searchInput.value = '';
        searchResults.innerHTML = '<p class="text-center text-white/30 py-8">输入关键词开始搜索</p>';
      }

      async function performSearch(query) {
        if (!query.trim()) {
          searchResults.innerHTML = '<p class="text-center text-white/30 py-8">输入关键词开始搜索</p>';
          return;
        }
        if (!pagefind) {
          searchResults.innerHTML = '<p class="text-center text-white/30 py-8">搜索功能需要部署后使用</p>';
          return;
        }
        try {
          const search = await pagefind.search(query);
          const results = await Promise.all(search.results.slice(0, 6).map(r => r.data()));
          if (results.length === 0) {
            searchResults.innerHTML = '<p class="text-center text-white/30 py-8">没有找到结果</p>';
            return;
          }
          searchResults.innerHTML = results.map(result => `
            <a href="${result.url}" class="block p-4 rounded-xl hover:bg-white/5 transition-colors">
              <div class="text-white mb-1">${result.meta?.title || '无标题'}</div>
              <div class="text-sm text-white/40 line-clamp-2">${result.excerpt}</div>
            </a>
          `).join('');
        } catch (e) {
          searchResults.innerHTML = '<p class="text-center text-white/30 py-8">搜索出错</p>';
        }
      }

      searchBtn.addEventListener('click', openSearch);
      searchOverlay.addEventListener('click', closeSearch);
      
      let debounceTimer;
      searchInput.addEventListener('input', function(e) {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(function() {
          performSearch(e.target.value);
        }, 300);
      });
      
      document.addEventListener('keydown', function(e) {
        if (e.key === 'k' && (e.metaKey || e.ctrlKey)) {
          e.preventDefault();
          openSearch();
        }
        if (e.key === 'Escape') closeSearch();
      });
    </script>
  </body>
</html>
